import{r as h,m as S,k as b,_ as I,d as P,i as g,w as C,e as v,o as k,b as y,j as _,g as W,c as q}from"./index-C6mb9JYZ.js";import{P as R}from"./PasswordStrengthIndicator-BtKcq5GS.js";function L(o,s,r={}){const e=h(null),c=h(!1),p=r.providerType||"jsAesCrypt";let d=null;const i=a=>{const n=a==="jsAesCrypt",u=a==="webCrypto"||a==="age";e.value&&(n&&d!=="classic"||u&&d!=="modern")&&(e.value.terminate(),e.value=null,d=null),e.value||(n?(e.value=new Worker("/worker.js"),d="classic"):(e.value=new Worker(new URL("/assets/cryptoWorker-DRYHjFPq.js",import.meta.url),{type:"module"}),d="modern"),e.value.onmessage=m)},m=a=>{const[n,u,w]=a.data;if(c.value=!1,n==="ERROR"){s==null||s(u,u);return}o==null||o(u,w)},f=(a,n,u,w=p)=>{if(!a||!n){console.error("useAESWorker: Missing fileData or password");return}c.value=!0,i(w),e.value.postMessage(["ENCRYPT",a,n,u,w])},l=(a,n,u,w=p)=>{if(!a||!n){console.error("useAESWorker: Missing fileData or password");return}c.value=!0,i(w),e.value.postMessage(["DECRYPT",a,n,u,w])},t=()=>{e.value&&(e.value.terminate(),e.value=null)};return S(()=>{t()}),{worker:e,isLoading:c,encrypt:f,decrypt:l,terminateWorker:t}}function j(o="encrypt"){const s=`slurm_aes_${o}_session_password`,r=h(!1),e=h(!1),c=()=>{try{const t=sessionStorage.getItem(s),a=!!t;return e.value=a,r.value=a,t}catch(t){return console.error("Failed to check session password:",t),e.value=!1,null}},p=t=>{if(!r.value||!t){i();return}try{sessionStorage.setItem(s,t),e.value=!0}catch(a){console.error("Failed to save session password:",a),e.value=!1}},d=()=>{try{return sessionStorage.getItem(s)}catch(t){return console.error("Failed to get session password:",t),null}},i=()=>{try{sessionStorage.removeItem(s)}catch(t){console.error("Failed to clear session password:",t)}finally{e.value=!1,r.value=!1}},m=()=>c()||"";b(r,t=>{t||i()});const f=()=>{document.hidden&&i()},l=()=>{i()};return typeof document<"u"&&(document.addEventListener("visibilitychange",f),window.addEventListener("blur",l)),S(()=>{typeof document<"u"&&(document.removeEventListener("visibilitychange",f),window.removeEventListener("blur",l))}),{rememberPassword:r,isPasswordRemembered:e,saveSessionPassword:p,getSessionPassword:d,clearSessionPassword:i,autoLoadPassword:m}}const B={name:"PasswordInput",components:{PasswordStrengthIndicator:R},props:{password:{type:String,required:!0,default:""},passwordConfirm:{type:String,default:""},requireConfirmation:{type:Boolean,default:!1},showStrength:{type:Boolean,default:!0},showRequirements:{type:Boolean,default:!0},showFeedback:{type:Boolean,default:!1},autocomplete:{type:String,default:"new-password",validator:o=>["new-password","current-password"].includes(o)},passwordLabel:{type:String,default:"Password"},passwordPlaceholder:{type:String,default:"Enter encryption password"},passwordIcon:{type:String,default:"mdi-lock"}},emits:["update:password","update:password-confirm","is-valid"],setup(o,{emit:s}){const r=h(!1),e=h(!1),c=h(!1),p=P(()=>o.requireConfirmation?o.password.trim()!==""&&o.password===o.passwordConfirm:!0),d=P(()=>o.requireConfirmation?o.password!==""&&o.passwordConfirm!==""&&o.password!==o.passwordConfirm:!1),i=P(()=>o.showRequirements&&c.value),m=n=>{s("update:password",n),a(n,o.passwordConfirm)},f=n=>{s("update:password-confirm",n),a(o.password,n)},l=()=>{c.value=!0},t=()=>{c.value=!1},a=(n,u)=>{if(!o.requireConfirmation)s("is-valid",n.trim()!=="");else{const w=n.trim()!==""&&n===u;s("is-valid",w)}};return{showPassword:r,showPasswordConfirm:e,isPasswordConfirmed:p,showConfirmError:d,showRequirementsComputed:i,handlePasswordInput:m,handlePasswordConfirmInput:f,handlePasswordFocus:l,handlePasswordBlur:t}}},F={key:0,tabindex:"-1"};function x(o,s,r,e,c,p){const d=v("v-text-field"),i=v("PasswordStrengthIndicator"),m=v("v-col"),f=v("v-row");return k(),g(f,null,{default:C(()=>[y(m,{cols:"12",sm:r.requireConfirmation?6:12},{default:C(()=>[W("div",{onFocusin:s[1]||(s[1]=(...l)=>e.handlePasswordFocus&&e.handlePasswordFocus(...l)),onFocusout:s[2]||(s[2]=(...l)=>e.handlePasswordBlur&&e.handlePasswordBlur(...l))},[y(d,{"model-value":r.password,label:r.passwordLabel,type:e.showPassword?"text":"password",variant:"outlined",density:"comfortable",autocomplete:r.autocomplete,maxlength:"1024",placeholder:r.passwordPlaceholder,"prepend-inner-icon":r.passwordIcon,"append-inner-icon":e.showPassword?"mdi-eye-off":"mdi-eye","hide-details":"","onUpdate:modelValue":e.handlePasswordInput,"onClick:appendInner":s[0]||(s[0]=l=>e.showPassword=!e.showPassword)},null,8,["model-value","label","type","autocomplete","placeholder","prepend-inner-icon","append-inner-icon","onUpdate:modelValue"]),r.showStrength?(k(),q("div",F,[y(i,{password:r.password,"show-requirements":e.showRequirementsComputed,"show-feedback":r.showFeedback},null,8,["password","show-requirements","show-feedback"])])):_("",!0)],32)]),_:1},8,["sm"]),r.requireConfirmation?(k(),g(m,{key:0,cols:"12",sm:"6"},{default:C(()=>[y(d,{"model-value":r.passwordConfirm,label:"Confirm Password",type:e.showPasswordConfirm?"text":"password",variant:"outlined",density:"comfortable",autocomplete:r.autocomplete,maxlength:"1024",placeholder:"Confirm encryption password","prepend-inner-icon":"mdi-lock-check","append-inner-icon":e.showPasswordConfirm?"mdi-eye-off":"mdi-eye",error:e.showConfirmError,success:e.isPasswordConfirmed,"hide-details":"","onUpdate:modelValue":e.handlePasswordConfirmInput,"onClick:appendInner":s[3]||(s[3]=l=>e.showPasswordConfirm=!e.showPasswordConfirm)},null,8,["model-value","type","autocomplete","append-inner-icon","error","success","onUpdate:modelValue"])]),_:1})):_("",!0)]),_:1})}const T=I(B,[["render",x]]);export{T as P,L as a,j as u};
