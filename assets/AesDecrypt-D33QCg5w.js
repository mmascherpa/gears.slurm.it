import{_ as ue,c as pe,a as o,i as y,f as D,g as S,w as a,k as me,r as v,b as F,h as K,d,o as k,e as u,t as G}from"./index-Be9HKwpV.js";import{d as X}from"./fileDownload-B1vhVzTR.js";import{C as ve,p as ye}from"./CsvPreviewTable-CqFZZzCF.js";import{P as fe,u as we,a as _e}from"./PasswordInput-BL-9FnSo.js";import{u as be}from"./useClipboard-KqVwDR14.js";import{u as xe}from"./useDebounce-CBVJKzh1.js";import{T as he,S as Te,u as ge}from"./ToolPageHeader-TgTx7KLi.js";import{T as Pe,F as ke}from"./TextInputWithActions-Ca2jwfS9.js";import"./PasswordStrengthIndicator-BgFDiEVo.js";import"./FileUpload-BDujieA5.js";const Ce={name:"AesDecrypt",components:{CsvPreviewTable:ve,FileUploadWithValidation:ke,PasswordInput:fe,SharedSnackbar:Te,TextInputWithActions:Pe,ToolPageHeader:he},setup(){const l=v(null),w=v(""),e=v(""),x=v(null),h=v(""),p=v(""),n=v(""),f=v(""),T=v([]),g=v([]),{snackbar:A,snackbarColor:_,snackbarText:b,showSnackbar:r}=ge(),{copyToClipboard:L,pasteFromClipboard:z}=be(),{rememberPassword:m,isPasswordRemembered:W,saveSessionPassword:V,clearSessionPassword:U,autoLoadPassword:M}=we("decrypt"),E=M();E&&(n.value=E);const{decrypt:I,isLoading:c}=_e((t,s)=>{C.value?ae(t):oe(t,s)},(t,s)=>{p.value=s,r(t,"error"),e.value=""}),B=F(()=>q.value&&(Z.value||C.value)),C=F(()=>h.value.trim()!==""),Z=F(()=>!!x.value),j=F(()=>!!f.value||g.value.length>0||T.value.length>0),q=F(()=>n.value.trim()!==""),R=()=>{m.value||(n.value=""),x.value=null,h.value=""},O=()=>{f.value="",e.value="",T.value=[],g.value=[],l.value=null,w.value=""},Q=()=>{h.value="",e.value="",p.value="",ce()},Y=()=>{try{const t=atob(h.value),s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return new Blob([s])}catch(t){return console.error("Base64 decode error:",t),p.value="Invalid Base64 format",r("❌ Invalid encrypted text format","error"),null}},$=()=>{if(!B.value)return;p.value="",e.value="";const t=Y();t&&I(t,n.value,"encrypted.aes")},ee=()=>{if(!B.value){r("Invalid inputs","error");return}p.value="",I(x.value,n.value,x.value.name)},te=()=>{l.value&&w.value&&(X(l.value,w.value),r("✓ File downloaded successfully!","success"))},oe=(t,s)=>{if(l.value=t,w.value=s,s.endsWith(".csv")){if(t.byteLength<=8388608){const i=ye(t);g.value=i.headers,T.value=i.data;const N=(t.byteLength/1024).toFixed(2);r(`✓ CSV file decrypted (${N} KB) - Preview shown`,"success")}else{X(t,s);const i=(t.byteLength/(1024*1024)).toFixed(2);r(`✓ CSV file decrypted (${i} MB) - Too large to preview, downloaded`,"info")}R();return}if(de(s,t)){const P=new TextDecoder().decode(t);f.value=P;const i=(t.byteLength/1024).toFixed(2);r(`✓ Text file decrypted (${i} KB) - Preview shown`,"success"),R();return}if(X(t,s),t.byteLength>8388608){const P=(t.byteLength/1048576).toFixed(2);r(`✓ File decrypted (${P} MB) - Too large to preview, downloaded`,"info")}else r("✓ File decrypted and downloaded!","success");R()},ae=t=>{try{const s=new TextDecoder().decode(t);e.value=s,r("✓ Text decrypted successfully!","success")}catch(s){console.error("Text decode error:",s),p.value="Failed to decode decrypted data",r("❌ Decryption failed","error")}},le=()=>{},se=async()=>{await L(e.value,t=>r(t,"success"),t=>r(t,"error"))},ne=async()=>{await z((t,s)=>{h.value=t,r(s,"success"),H()},t=>r(t,"error"))},re=()=>{e.value="",p.value="",H()},{cancel:ce,debounce:H}=xe(()=>{B.value&&C.value&&$()},800),de=(t,s)=>{const i=[".txt",".md",".json",".xml",".html",".css",".js",".log",".yaml",".yml"].some(ie=>t.toLowerCase().endsWith(ie)),N=s.byteLength<=8388608;return i&&N};return K(x,t=>{t&&(j.value||w.value)&&O()}),K(m,t=>{t&&n.value&&V(n.value)}),K(n,(t,s)=>{m.value&&t&&V(t),t&&t!==s&&(j.value||w.value)&&O(),C.value&&(e.value="",p.value="",H())}),{decryptedFileName:w,decryptedText:e,encryptedFile:x,encryptedText:h,error:p,isLoading:c,password:n,plainText:f,tableData:T,tableHeaders:g,rememberPassword:m,isPasswordRemembered:W,clearSessionPassword:U,snackbar:A,snackbarColor:_,snackbarText:b,canDecrypt:B,isEncryptedTextPopulated:C,isFilePopulated:Z,isPasswordPopulated:q,clearEncryptedText:Q,clearOutputs:O,decryptFile:ee,downloadDecryptedText:te,handleCopy:se,handleEncryptedTextChange:re,handleFileValidation:le,handlePaste:ne}}},De=y("input",{type:"text",name:"username",autocomplete:"username",style:{display:"none"},"aria-hidden":"true"},null,-1),Se={class:"d-flex align-start"},Fe={class:"flex-grow-1"},Ve=y("div",{class:"text-h6 font-weight-medium mb-2"},"Decryption Failed",-1),Ee={class:"text-body-1"},Ie={class:"flex-grow-1"},Be=y("div",{class:"text-subtitle-1 font-weight-medium"},"File Decrypted Successfully",-1),Ae={class:"text-body-2"},Le=y("p",{class:"text-h6 mt-4"},"Decrypting...",-1);function ze(J,l,w,e,x,h){const p=d("ToolPageHeader"),n=d("v-icon"),f=d("v-card-title"),T=d("PasswordInput"),g=d("v-checkbox"),A=d("v-chip"),_=d("v-card-text"),b=d("v-card"),r=d("TextInputWithActions"),L=d("v-divider"),z=d("FileUploadWithValidation"),m=d("v-btn"),W=d("v-spacer"),V=d("v-textarea"),U=d("CsvPreviewTable"),M=d("SharedSnackbar"),E=d("v-progress-circular"),I=d("v-overlay");return k(),pe("div",null,[o(p,{icon:"mdi-lock-open",title:"AES Decryption",description:"Decrypt password-protected AES encrypted files and text","avatar-color":"primary-darken-1"}),y("form",{onSubmit:l[5]||(l[5]=me((...c)=>e.decryptFile&&e.decryptFile(...c),["prevent"]))},[De,o(b,{class:"mb-4"},{default:a(()=>[o(f,{class:"bg-surface-variant"},{default:a(()=>[o(n,{icon:"mdi-key",class:"mr-2"}),u(" Enter Password ")]),_:1}),o(_,{class:"pa-4"},{default:a(()=>[o(T,{password:e.password,"onUpdate:password":l[0]||(l[0]=c=>e.password=c),"require-confirmation":!1,"show-strength":!0,"show-requirements":!1,"show-feedback":!1,autocomplete:"current-password","password-label":"Decryption Password","password-placeholder":"Enter the password used for encryption","password-icon":"mdi-lock-open"},null,8,["password"]),o(g,{modelValue:e.rememberPassword,"onUpdate:modelValue":l[1]||(l[1]=c=>e.rememberPassword=c),label:"Remember password for this session",hint:"⚠️ Only use on trusted devices. Password stored in browser memory until tab closes.","persistent-hint":"",density:"comfortable",class:"mt-2",color:"warning"},null,8,["modelValue"]),e.isPasswordRemembered?(k(),D(A,{key:0,color:"info",variant:"tonal",size:"small","prepend-icon":"mdi-memory",closable:"","onClick:close":e.clearSessionPassword,class:"mt-2"},{default:a(()=>[u(" Password remembered for session ")]),_:1},8,["onClick:close"])):S("",!0)]),_:1})]),_:1}),o(b,{class:"mb-4"},{default:a(()=>[o(f,{class:"bg-surface-variant"},{default:a(()=>[o(n,{icon:"mdi-lock",class:"mr-2"}),u(" Encrypted Text ")]),_:1}),o(_,{class:"pa-4"},{default:a(()=>[o(r,{modelValue:e.encryptedText,"onUpdate:modelValue":l[2]||(l[2]=c=>e.encryptedText=c),label:"Paste encrypted Base64 text",placeholder:"Paste the encrypted text here...",rows:4,disabled:e.isFilePopulated,"show-paste":!e.isFilePopulated,"show-clear":!0,"show-copy":!1,"test-id":"encrypted-text-input",onPaste:e.handlePaste,onClear:e.clearEncryptedText,onInput:e.handleEncryptedTextChange},null,8,["modelValue","disabled","show-paste","onPaste","onClear","onInput"]),o(L,{class:"my-4"}),o(r,{modelValue:e.decryptedText,"onUpdate:modelValue":l[3]||(l[3]=c=>e.decryptedText=c),label:"Decrypted Text",placeholder:"Decrypted output will appear here...",rows:4,"is-loading":e.isLoading,readonly:!0,"show-paste":!1,"show-clear":!1,"show-copy":!0,"test-id":"output-text",onCopy:e.handleCopy},null,8,["modelValue","is-loading","onCopy"])]),_:1})]),_:1}),o(b,{class:"mb-4"},{default:a(()=>[o(f,{class:"bg-surface-variant"},{default:a(()=>[o(n,{icon:"mdi-file-lock",class:"mr-2"}),u(" Encrypted File ")]),_:1}),o(_,{class:"pa-4"},{default:a(()=>[o(z,{modelValue:e.encryptedFile,"onUpdate:modelValue":l[4]||(l[4]=c=>e.encryptedFile=c),label:"Select encrypted file (.aes)",accept:".aes","button-text":"Decrypt","button-icon":"mdi-lock-open",disabled:e.isEncryptedTextPopulated,"can-submit":e.canDecrypt,onSubmit:e.decryptFile,onValidationChange:e.handleFileValidation},null,8,["modelValue","disabled","can-submit","onSubmit","onValidationChange"])]),_:1})]),_:1})],32),e.error?(k(),D(b,{key:0,variant:"tonal",color:"error",class:"mb-4"},{default:a(()=>[o(_,{class:"pa-4"},{default:a(()=>[y("div",Se,[o(n,{icon:"mdi-alert-circle",size:"32",color:"error",class:"mr-4 mt-1"}),y("div",Fe,[Ve,y("div",Ee,G(e.error),1)]),o(m,{icon:"",size:"small",variant:"text",onClick:l[6]||(l[6]=c=>e.error=""),class:"ml-2"},{default:a(()=>[o(n,null,{default:a(()=>[u("mdi-close")]),_:1})]),_:1})])]),_:1})]),_:1})):S("",!0),e.plainText?(k(),D(b,{key:1,variant:"tonal",class:"mb-4"},{default:a(()=>[o(f,{class:"d-flex align-center","data-testid":"file-info"},{default:a(()=>[o(n,{icon:"mdi-text",class:"mr-2"}),u(" Decrypted Text "),o(W),e.decryptedFileName?(k(),D(m,{key:0,variant:"text",color:"primary",onClick:e.downloadDecryptedText,class:"mr-2"},{default:a(()=>[o(n,{start:""},{default:a(()=>[u("mdi-download")]),_:1}),u(" Download ")]),_:1},8,["onClick"])):S("",!0),o(m,{icon:"",size:"small",variant:"text",onClick:e.clearOutputs},{default:a(()=>[o(n,null,{default:a(()=>[u("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),o(_,{class:"pa-4"},{default:a(()=>[o(V,{modelValue:e.plainText,"onUpdate:modelValue":l[7]||(l[7]=c=>e.plainText=c),variant:"outlined",rows:"10",readonly:"","bg-color":"grey-lighten-4",placeholder:"Decrypted text","data-testid":"file-preview","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})):S("",!0),o(U,{headers:e.tableHeaders,data:e.tableData,"show-download":!!e.decryptedFileName,"card-class":"mb-4","test-id":"file-preview",onClose:e.clearOutputs,onDownload:e.downloadDecryptedText},null,8,["headers","data","show-download","onClose","onDownload"]),e.decryptedFileName&&!e.plainText&&!e.tableData.length?(k(),D(b,{key:2,variant:"tonal",color:"success"},{default:a(()=>[o(_,{class:"d-flex align-center pa-4"},{default:a(()=>[o(n,{icon:"mdi-check-circle",size:"32",class:"mr-4"}),y("div",Ie,[Be,y("div",Ae,G(e.decryptedFileName),1)]),o(m,{variant:"elevated",color:"white",onClick:e.downloadDecryptedText,class:"mr-2"},{default:a(()=>[o(n,{start:""},{default:a(()=>[u("mdi-download")]),_:1}),u(" Download Again ")]),_:1},8,["onClick"]),o(m,{icon:"",size:"small",variant:"text",onClick:e.clearOutputs},{default:a(()=>[o(n,null,{default:a(()=>[u("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):S("",!0),o(M,{modelValue:e.snackbar,"onUpdate:modelValue":l[8]||(l[8]=c=>e.snackbar=c),text:e.snackbarText,color:e.snackbarColor},null,8,["modelValue","text","color"]),o(I,{"model-value":e.isLoading,class:"align-center justify-center"},{default:a(()=>[o(E,{indeterminate:"",size:"64",color:"primary"}),Le]),_:1},8,["model-value"])])}const je=ue(Ce,[["render",ze]]);export{je as default};
