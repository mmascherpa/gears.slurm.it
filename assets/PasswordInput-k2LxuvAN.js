import{r as v,m as _,n as g,k as x,_ as F,d as P,i as k,w as C,e as h,o as b,b as y,j as S,g as I,c as q}from"./index-CLKbXmT3.js";import{P as E}from"./PasswordStrengthIndicator-CaVB0Qrk.js";function A(s,r,n={}){const e=v(null),a=v(!1),o=n.providerType||"jsAesCrypt";let l=null;const u=i=>{const t=i==="jsAesCrypt",w=i==="webCrypto"||i==="age";e.value&&(t&&l!=="classic"||w&&l!=="modern")&&(e.value.terminate(),e.value=null,l=null),e.value||(t?(e.value=new Worker("/worker.js"),l="classic"):(e.value=new Worker(new URL("/assets/cryptoWorker-DRYHjFPq.js",import.meta.url),{type:"module"}),l="modern"),e.value.onmessage=m)},m=i=>{const[t,w,f]=i.data;if(a.value=!1,t==="ERROR"){r==null||r(w,w);return}s==null||s(w,f)},p=(i,t,w,f=o)=>{if(!i||!t){console.error("useAESWorker: Missing fileData or password");return}a.value=!0,u(f),e.value.postMessage(["ENCRYPT",i,t,w,f])},c=(i,t,w,f=o)=>{if(!i||!t){console.error("useAESWorker: Missing fileData or password");return}a.value=!0,u(f),e.value.postMessage(["DECRYPT",i,t,w,f])},d=()=>{e.value&&(e.value.terminate(),e.value=null)};return _(()=>{d()}),{worker:e,isLoading:a,encrypt:p,decrypt:c,terminateWorker:d}}function j(){return{focusElement:async(e,a={})=>{var u;const{preventScroll:o=!1,delay:l=0}=a;await g(),l>0&&await new Promise(m=>setTimeout(m,l)),e!=null&&e.value&&(typeof e.value.focus=="function"?e.value.focus({preventScroll:o}):(u=e.value.$el)!=null&&u.focus?e.value.$el.focus({preventScroll:o}):e.value instanceof HTMLElement&&e.value.focus({preventScroll:o}))},focusFirst:async e=>{var u;await g();const a=((u=e==null?void 0:e.value)==null?void 0:u.$el)||(e==null?void 0:e.value);if(!a)return;const o=["button:not([disabled])","input:not([disabled])","textarea:not([disabled])","select:not([disabled])","a[href]",'[tabindex]:not([tabindex="-1"])'].join(", "),l=a.querySelector(o);l&&l.focus()},announceToScreenReader:(e,a="polite")=>{let o=document.getElementById("sr-announcer");o||(o=document.createElement("div"),o.id="sr-announcer",o.setAttribute("aria-live",a),o.setAttribute("aria-atomic","true"),o.className="sr-only",o.style.cssText=`
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      `,document.body.appendChild(o)),o.setAttribute("aria-live",a),o.textContent="",requestAnimationFrame(()=>{o.textContent=e})}}}function M(s="encrypt"){const r=`slurm_aes_${s}_session_password`,n=v(!1),e=v(!1),a=()=>{try{const d=sessionStorage.getItem(r),i=!!d;return e.value=i,n.value=i,d}catch(d){return console.error("Failed to check session password:",d),e.value=!1,null}},o=d=>{if(!n.value||!d){u();return}try{sessionStorage.setItem(r,d),e.value=!0}catch(i){console.error("Failed to save session password:",i),e.value=!1}},l=()=>{try{return sessionStorage.getItem(r)}catch(d){return console.error("Failed to get session password:",d),null}},u=()=>{try{sessionStorage.removeItem(r)}catch(d){console.error("Failed to clear session password:",d)}finally{e.value=!1,n.value=!1}},m=()=>a()||"";x(n,d=>{d||u()});const p=()=>{document.hidden&&u()},c=()=>{u()};return typeof document<"u"&&(document.addEventListener("visibilitychange",p),window.addEventListener("blur",c)),_(()=>{typeof document<"u"&&(document.removeEventListener("visibilitychange",p),window.removeEventListener("blur",c))}),{rememberPassword:n,isPasswordRemembered:e,saveSessionPassword:o,getSessionPassword:l,clearSessionPassword:u,autoLoadPassword:m}}const W={name:"PasswordInput",components:{PasswordStrengthIndicator:E},props:{password:{type:String,required:!0,default:""},passwordConfirm:{type:String,default:""},requireConfirmation:{type:Boolean,default:!1},showStrength:{type:Boolean,default:!0},showRequirements:{type:Boolean,default:!0},showFeedback:{type:Boolean,default:!1},autocomplete:{type:String,default:"new-password",validator:s=>["new-password","current-password"].includes(s)},passwordLabel:{type:String,default:"Password"},passwordPlaceholder:{type:String,default:"Enter encryption password"},passwordIcon:{type:String,default:"mdi-lock"}},emits:["update:password","update:password-confirm","is-valid"],setup(s,{emit:r}){const n=v(!1),e=v(!1),a=v(!1),o=P(()=>s.requireConfirmation?s.password.trim()!==""&&s.password===s.passwordConfirm:!0),l=P(()=>s.requireConfirmation?s.password!==""&&s.passwordConfirm!==""&&s.password!==s.passwordConfirm:!1),u=P(()=>s.showRequirements&&a.value),m=t=>{r("update:password",t),i(t,s.passwordConfirm)},p=t=>{r("update:password-confirm",t),i(s.password,t)},c=()=>{a.value=!0},d=()=>{a.value=!1},i=(t,w)=>{if(!s.requireConfirmation)r("is-valid",t.trim()!=="");else{const f=t.trim()!==""&&t===w;r("is-valid",f)}};return{showPassword:n,showPasswordConfirm:e,isPasswordConfirmed:o,showConfirmError:l,showRequirementsComputed:u,handlePasswordInput:m,handlePasswordConfirmInput:p,handlePasswordFocus:c,handlePasswordBlur:d}}},B={key:0,tabindex:"-1"};function T(s,r,n,e,a,o){const l=h("v-text-field"),u=h("PasswordStrengthIndicator"),m=h("v-col"),p=h("v-row");return b(),k(p,null,{default:C(()=>[y(m,{cols:"12",sm:n.requireConfirmation?6:12},{default:C(()=>[I("div",{onFocusin:r[1]||(r[1]=(...c)=>e.handlePasswordFocus&&e.handlePasswordFocus(...c)),onFocusout:r[2]||(r[2]=(...c)=>e.handlePasswordBlur&&e.handlePasswordBlur(...c))},[y(l,{"model-value":n.password,label:n.passwordLabel,type:e.showPassword?"text":"password",variant:"outlined",density:"comfortable",autocomplete:n.autocomplete,maxlength:"1024",placeholder:n.passwordPlaceholder,"prepend-inner-icon":n.passwordIcon,"append-inner-icon":e.showPassword?"mdi-eye-off":"mdi-eye","hide-details":"","onUpdate:modelValue":e.handlePasswordInput,"onClick:appendInner":r[0]||(r[0]=c=>e.showPassword=!e.showPassword)},null,8,["model-value","label","type","autocomplete","placeholder","prepend-inner-icon","append-inner-icon","onUpdate:modelValue"]),n.showStrength?(b(),q("div",B,[y(u,{password:n.password,"show-requirements":e.showRequirementsComputed,"show-feedback":n.showFeedback},null,8,["password","show-requirements","show-feedback"])])):S("",!0)],32)]),_:1},8,["sm"]),n.requireConfirmation?(b(),k(m,{key:0,cols:"12",sm:"6"},{default:C(()=>[y(l,{"model-value":n.passwordConfirm,label:"Confirm Password",type:e.showPasswordConfirm?"text":"password",variant:"outlined",density:"comfortable",autocomplete:n.autocomplete,maxlength:"1024",placeholder:"Confirm encryption password","prepend-inner-icon":"mdi-lock-check","append-inner-icon":e.showPasswordConfirm?"mdi-eye-off":"mdi-eye",error:e.showConfirmError,success:e.isPasswordConfirmed,"hide-details":"","onUpdate:modelValue":e.handlePasswordConfirmInput,"onClick:appendInner":r[3]||(r[3]=c=>e.showPasswordConfirm=!e.showPasswordConfirm)},null,8,["model-value","type","autocomplete","append-inner-icon","error","success","onUpdate:modelValue"])]),_:1})):S("",!0)]),_:1})}const N=F(W,[["render",T]]);export{N as P,A as a,j as b,M as u};
